{% extends "base.html" %}
{% block body_extra %}
<script>
  window.addEventListener("load", () => {
    const ctx = document.getElementById("scoreChart");
    if (!ctx) return;
    const payload = {{ chart_data | safe }};
    new Chart(ctx, {
      type: "radar",
      data: {
        labels: payload.labels,
        datasets: [
          {
            label: "Scores",
            data: payload.data,
            backgroundColor: "rgba(75, 107, 253, 0.2)",
            borderColor: "#4b6bfd",
            borderWidth: 2,
            pointBackgroundColor: "#4b6bfd",
          },
        ],
      },
      options: {
        plugins: {
          legend: {
            labels: {
              color: "#c6cdff",
            },
          },
        },
        scales: {
          r: {
            suggestedMin: 0,
            suggestedMax: 5,
            grid: {
              color: "rgba(255, 255, 255, 0.12)",
            },
            angleLines: {
              color: "rgba(255, 255, 255, 0.12)",
            },
            pointLabels: {
              color: "#f5f6fb",
            },
            ticks: {
              stepSize: 1,
              color: "#a8b0d8",
              backdropColor: "transparent",
            },
          },
        },
      },
    });
  });
</script>
{% endblock %}
{% block content %}
<section class="container report">
  <div class="section-heading">
    <div>
      <p class="eyebrow">Evaluation report</p>
      <h1>{{ evaluation.app_name }}</h1>
      <p class="lead">Audience: {{ evaluation.audience or "General" }} · Created {{ evaluation.created_at.strftime('%d %b %Y') }}</p>
    </div>
    <div class="score-pill large">Quality Score {{ '%.1f' | format(evaluation.quality_score) }}%</div>
  </div>

  <div class="grid-2">
    <article class="card">
      <h3>Dimension breakdown</h3>
      <canvas id="scoreChart" width="400" height="300"></canvas>
      <div class="dimension-breakdown">
        {% for dim in dimension_breakdown %}
          <div class="dimension-row">
            <div>
              <p class="dimension-label">{{ dim.label }} · <strong>{{ dim.score }}/5</strong></p>
              <p class="muted">{{ dim.descriptor }}</p>
            </div>
            <span class="status-pill status-{{ dim.tone }}">{{ dim.status }}</span>
          </div>
          <div class="progress-track">
            <div class="progress-bar" style="width: {{ (dim.score / 5 * 100)|round(0) }}%"></div>
          </div>
          <p class="muted">{{ dim.note }}</p>
        {% endfor %}
      </div>
    </article>
    <article class="card">
      <h3>Insight highlights</h3>
      <ul class="insight-list">
        {% for item in insight %}
          <li>{{ item }}</li>
        {% endfor %}
      </ul>
      <div class="stat-card">
        <div>
          <p class="muted">Pedagogy</p>
          <p class="stat-value">{{ evaluation.pedagogical_design }}/5</p>
        </div>
        <div>
          <p class="muted">UI/UX</p>
          <p class="stat-value">{{ evaluation.ui_ux }}/5</p>
        </div>
        <div>
          <p class="muted">Engagement</p>
          <p class="stat-value">{{ evaluation.engagement }}/5</p>
        </div>
        <div>
          <p class="muted">Technical</p>
          <p class="stat-value">{{ evaluation.technical_performance }}/5</p>
        </div>
        <div>
          <p class="muted">Learning</p>
          <p class="stat-value">{{ evaluation.learning_effectiveness }}/5</p>
        </div>
      </div>
    </article>
  </div>

  <article class="card">
    <h3>Context</h3>
    <p>{{ evaluation.summary or "No summary provided." }}</p>
  </article>
</section>
{% endblock %}
